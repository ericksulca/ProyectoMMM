{% extends 'base/base_login.html'%}
{% load staticfiles %}

{%block content%}

<h1>PÃ¡gina principal usuario</h1>

<!-- Area Chart Example-->
<div class="card mb-3">
  <div class="card-header">
    <i class="fas fa-chart-area"></i>
    Area Chart Example</div>
  <div class="card-body">
    <canvas id="MyChart" width="100%" height="30"></canvas>
  </div>
  <div class="card-footer small text-muted">Updated yesterday at 11:59 PM</div>
</div>

<!-- DataTables Example -->
<div class="card mb-3">
  <div class="card-header">
    <i class="fas fa-table"></i>
    Data Table Example {% if user is None %}Sesion no iniciada {% else %} {{username}} {% endif %}</div>
  <div class="card-body">
    <div class="table-responsive">
      <table class="table table-bordered" id="dataTable" width="100%" cellspacing="0">
        <thead>
          <tr>
            <th>Saldo</th>
            <th>Fecha</th>
          </tr>
        </thead>
        <tfoot>
        </tfoot>
      </table>
    </div>
  </div>
  <div class="card-footer small text-muted">Actualizado ayer 11:59 PM</div>
</div>

{%endblock%}

{% block scripts %}

<script>
  var endpoint = '/Usuario/saldo/listar/'

  // $(document).ready(function() {
  //   saldos_listar();
  // });

  // var saldos_listar = function() {
  //   var table = $('#dataTable').DataTable({
  //     "processing": true,
  //     "ajax": {
  //       method: "GET",
  //       url: "/Usuario/saldo/listar/",
  //       "dataSrc": "",
  //     },
  //     "columns":[
  //       {"data": "fields.saldo"},
  //       {"data": "fields.fecha_creacion"}
  //     ]
  //   });
  // }

// window.onload = function() {
//   var ctx = document.getElementById("myChart");
//   console.log(ctx);
//   alert('evento load detectado!');
// }

window.onload = function() {
  var fechas = [];
  var saldos = [];
  var ctx = document.getElementById("MyChart");
  $.ajax({
    method: 'GET',
    url: endpoint,
    success: function(data) {
      data.forEach(element => {
        fechas.push(element.fields.fecha_creacion);
        saldos.push(element.fields.saldo);
      });
      console.log(fechas);
      console.log(saldos);
      console.log(ctx);
      var myChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: fechas,
            datasets: [{
                label: 'Saldo respecto al tiempo',
                data: saldos,
                borderWidth: 1
            }]
        },
        options: {
            scales: {
                yAxes: [{
                    ticks: {
                        beginAtZero:true
                    }
                }]
            }
        }
      });
    },
  error: function(error_data) {
      console.log("error");
      console.log(error_data)
  }
});

}

// $.ajax({
//       method: 'GET',
//       url: endpoint,
//       success: function(data) {
//         data.forEach(element => {
//           labels.push(element.fields.fecha_creacion)
//           saldos.push(element.fields.saldo)
//         });
//       },
//       error: function(error_data) {
//         console.log("error");
//         console.log(error_data)
//     }
//   });

//   console.log(labels);
//   console.log(saldos);
  
</script>

{% endblock %}
